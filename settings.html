<!-- lightweight fallback settings template; the extension also provides a modal UI so this file is optional -->
<div class="swarmui-settings">
    <h3>SwarmUI Extension</h3>
    <label>Swarm Base URL<br /><input id="swarm_base_url" type="text" placeholder="http://127.0.0.1:8000" /></label>
    <label>Use WebSocket<br /><input id="swarm_use_ws" type="checkbox" /></label>
    <label>Auth Header (optional)<br /><input id="swarm_auth_header" type="text" placeholder="Bearer ..." /></label>
    <label>Images per request<br /><input id="swarm_images" type="number" min="1" max="10" value="1" /></label>
    <label>LLM prompt template<br /><textarea id="swarm_llm_prompt_template">Create a detailed image prompt describing: {{last_message}}</textarea></label>
    <label>Append Swarm's current prompt (best-effort)<br /><input id="swarm_append_swarm_prompt" type="checkbox" /></label>
    <div style="margin-top:8px;"><button id="swarm_settings_save">Save</button></div>
</div>

<script>// Minimal wiring if settings.html is rendered by ST's template engine.
  (function(){
    const MODULE = 'swarmui';
    const s = (window.extension_settings && window.extension_settings[MODULE]) || {};
    try { document.getElementById('swarm_base_url').value = s.swarm_base_url || ''; } catch(e){}
    try { document.getElementById('swarm_use_ws').checked = !!s.swarm_use_ws; } catch(e){}
    try { document.getElementById('swarm_auth_header').value = s.swarm_auth_header || ''; } catch(e){}
    try { document.getElementById('swarm_images').value = s.swarm_images || 1; } catch(e){}
    try { document.getElementById('swarm_llm_prompt_template').value = s.swarm_llm_prompt_template || document.getElementById('swarm_llm_prompt_template').value; } catch(e){}
    try { document.getElementById('swarm_append_swarm_prompt').checked = !!s.swarm_append_swarm_prompt; } catch(e){}
    document.getElementById('swarm_settings_save').onclick = function(){
      const newSettings = {
        swarm_base_url: document.getElementById('swarm_base_url').value.trim(),
        swarm_use_ws: document.getElementById('swarm_use_ws').checked,
        swarm_auth_header: document.getElementById('swarm_auth_header').value.trim(),
        swarm_images: parseInt(document.getElementById('swarm_images').value,10)||1,
        swarm_llm_prompt_template: document.getElementById('swarm_llm_prompt_template').value,
        swarm_append_swarm_prompt: document.getElementById('swarm_append_swarm_prompt').checked
      };
      if (typeof writeExtensionField === 'function') {
        try { writeExtensionField(MODULE, JSON.stringify(newSettings)); } catch(e){ localStorage.setItem('swarmui_settings', JSON.stringify(newSettings)); }
      } else {
        localStorage.setItem('swarmui_settings', JSON.stringify(newSettings));
      }
      alert('Saved');
    }
  })();